<div *ngIf="project && showForm" class="bg-white p-6 rounded-lg shadow-md">
  <header class="mb-6">
    <h2 class="text-2xl font-bold text-gray-800">Modifier le projet</h2>
  </header>

  <form #editForm="ngForm" (ngSubmit)="onSubmit(editForm)" class="space-y-4">
    <!-- Nom du projet -->
    <div>
      <label for="editName" class="block text-sm font-medium text-gray-700 mb-2">Nom du projet</label>
      <input
        type="text"
        id="editName"
        name="name"
        [(ngModel)]="project.name"
        required
        #name="ngModel"
        [ngClass]="{
          'border-red-500': name.invalid && name.touched
        }"
        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
      <div *ngIf="name.invalid && name.touched" class="text-red-500 text-sm mt-1">
        <div *ngIf="name.errors?.['required']">Le nom du projet est obligatoire.</div>
      </div>
    </div>

    <!-- Description -->
    <div>
      <label for="editDescription" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
      <textarea
        id="editDescription"
        name="description"
        [(ngModel)]="project.description"
        required
        #description="ngModel"
        rows="4"
        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
      ></textarea>
      <div *ngIf="description.invalid && description.touched" class="text-red-500 text-sm mt-1">
        La description est obligatoire.
      </div>
    </div>

    <!-- Statut -->
    <div>
      <label for="editStatus" class="block text-sm font-medium text-gray-700 mb-2">Statut</label>
      <select
        id="editStatus"
        name="status"
        [(ngModel)]="project.status"
        required
        #status="ngModel"
        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <option value="">Sélectionnez un statut</option>
        <option value="En cours">En cours</option>
        <option value="Terminé">Terminé</option>
        <option value="En attente">En attente</option>
      </select>
      <div *ngIf="status.invalid && status.touched" class="text-red-500 text-sm mt-1">
        Le statut ne doit pas être vide.
      </div>
    </div>

    <!-- Modifier les tâches -->
    <div>
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Modifier les tâches</h3>

      <!-- Liste des tâches existantes -->
      <div *ngIf="project.tasks && project.tasks.length > 0" class="mb-4">
        <h4 class="text-md font-medium text-gray-700 mb-2">Tâches existantes:</h4>
        <ul class="space-y-2">
          <li *ngFor="let task of project.tasks; let i = index" class="flex justify-between items-center bg-gray-100 p-3 rounded-lg">
            <div class="flex-1">
              <input
                type="text"
                [(ngModel)]="task.title"
                name="taskTitle{{i}}"
                class="w-full px-2 py-1 border rounded mb-1"
                placeholder="Titre de la tâche"
              />
              <div class="flex gap-2">
                <select
                  [(ngModel)]="task.priority"
                  name="taskPriority{{i}}"
                  class="px-2 py-1 border rounded text-sm"
                >
                  <option value="Haute">Haute</option>
                  <option value="Moyenne">Moyenne</option>
                  <option value="Basse">Basse</option>
                </select>
                <select
                  [(ngModel)]="task.status"
                  name="taskStatus{{i}}"
                  class="px-2 py-1 border rounded text-sm"
                >
                  <option value="En cours">En cours</option>
                  <option value="Terminé">Terminé</option>
                  <option value="En attente">En attente</option>
                </select>
              </div>
            </div>
            <button
              type="button"
              (click)="removeTask(i)"
              class="text-red-500 hover:text-red-700 ml-2"
            >
              Supprimer
            </button>
          </li>
        </ul>
      </div>

      <!-- Ajouter une nouvelle tâche -->
      <div class="bg-gray-50 p-4 rounded-lg">
        <h4 class="text-md font-medium text-gray-700 mb-2">Ajouter une nouvelle tâche:</h4>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Titre de la tâche</label>
            <input
              type="text"
              [(ngModel)]="newTask.title"
              name="newTaskTitle"
              class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="Titre de la tâche"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Priorité</label>
            <select
              [(ngModel)]="newTask.priority"
              name="newTaskPriority"
              class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="">Priorité</option>
              <option value="Haute">Haute</option>
              <option value="Moyenne">Moyenne</option>
              <option value="Basse">Basse</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Statut</label>
            <select
              [(ngModel)]="newTask.status"
              name="newTaskStatus"
              class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="">Statut</option>
              <option value="En cours">En cours</option>
              <option value="Terminé">Terminé</option>
              <option value="En attente">En attente</option>
            </select>
          </div>
        </div>
        <button
          type="button"
          (click)="addTask()"
          class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
        >
          Ajouter la tâche
        </button>
      </div>
    </div>

    <!-- Boutons -->
    <div class="flex gap-4">
      <button
        type="button"
        (click)="onSubmit(editForm)"
        [disabled]="editForm.invalid"
        class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed"
      >
        Enregistrer
      </button>
      <button
        type="button"
        (click)="onCancel()"
        class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"
      >
        Annuler
      </button>
    </div>
  </form>
</div>
